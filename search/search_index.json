{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\ud83c\udfe0 Statathon API Gateway","text":"<p>Welcome to the documentation for  Statathon Dataset API Gateway. This project enables structured access to official survey microdata using:</p> <ul> <li>DDI-based ingestion of ZIP datasets</li> <li>Filtered SQL API queries (with role-based control)</li> <li>Usage metering + rate limits</li> <li>Cell suppression &amp; aggregation (for privacy)</li> <li>Micro-payment integration(To be integrated)</li> <li>Swagger / Postman / MkDocs documentation</li> </ul>"},{"location":"#project-structure","title":"Project Structure","text":"Folder/File Description <code>main.py</code> FastAPI app entrypoint <code>routers/</code> Contains upload, query, and auth endpoints <code>auth/local/</code> JWT-based auth system with role checks <code>utils/</code> Helpers for parsing DDI, converting, validating <code>templates/</code> Contains the HTML files for all the pages. <code>docs/</code> MkDocs-based API documentation <code>query/</code> Conains the route for query data"},{"location":"#how-to-test","title":"How to Test","text":"<p>You can use Postman or Swagger UI (<code>/docs</code>) to test the APIs.</p>"},{"location":"#1-login","title":"\ud83d\udd11 1. Login","text":"<pre><code>POST /auth/token\n</code></pre> <p>Body (form):</p> <pre><code>username: statathon12@gmail.com\npassword: yourpassword\n</code></pre> <p>Copy the <code>access_token</code> from response.</p>"},{"location":"#2-upload-dataset-admin-only","title":"\ud83d\udce4 2. Upload Dataset (Admin Only)","text":"<pre><code>POST /upload/\n</code></pre> <p>Form Data:</p> <ul> <li>file: NSS.zip</li> <li>schema: public</li> </ul> <p>Header:</p> <pre><code>Authorization: Bearer &lt;ADMIN_JWT&gt;\n</code></pre>"},{"location":"#3-query-dataset","title":"\ud83d\udce5 3. Query Dataset","text":"<pre><code>GET /datasets/{table_name}/query?limit=10&amp;columns=A,B,C&amp;filters=X=Y\n</code></pre> <p>Headers:</p> <pre><code>Authorization: Bearer &lt;USER_OR_ADMIN_JWT&gt;\nAccept: application/json OR text/csv\n</code></pre>"},{"location":"#4-view-usage-logs-admin-sql","title":"\ud83d\udcca 4. View Usage Logs (Admin SQL)","text":"<p>Use a database client to run:</p> <pre><code>SELECT user_email, queried_at::date, SUM(rows_returned) AS total_rows\nFROM usage_logs\nGROUP BY user_email, queried_at::date\nORDER BY queried_at DESC;\n</code></pre>"},{"location":"#documentation-sections","title":"\ud83d\udcda Documentation Sections","text":"<ul> <li>API Reference</li> <li>Authentication</li> <li>Usage Metering</li> </ul> <p>Enjoy building privacy-compliant data systems \ud83d\ude80</p>"},{"location":"api/","title":"API Reference","text":"<p>This section documents the core APIs of  Statathon Dataset Gateway.</p>"},{"location":"api/#query-a-dataset","title":"Query a Dataset","text":"<p>GET <code>/datasets/{table_name}/query</code></p> <p>Use this endpoint to query any dataset table with filters, column selection, and pagination.</p>"},{"location":"api/#parameters","title":"\ud83d\udd39 Parameters:","text":"Param Type Description <code>columns</code> string Comma-separated list of columns to return <code>filters</code> string Filter expression using SQL operators (<code>=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>IN</code>) <code>limit</code> integer Number of rows to return (default: 100) <code>offset</code> integer Number of rows to skip (default: 0)"},{"location":"api/#auth-required","title":"\ud83d\udd10 Auth Required:","text":"<ul> <li>Bearer token (admin or user)</li> </ul>"},{"location":"api/#example-1-admin-full-json-response","title":"Example 1: Admin (Full JSON Response)","text":"<p>Request:</p> <pre><code>GET /datasets/block_5_2_usual_subsidiary_economic_activity_particulars_of_hou/query?limit=10&amp;offset=0&amp;columns=Round_Centre_Code,FSU_Serial_No,Round,Sch_No\n</code></pre> <p>Headers:</p> <pre><code>Authorization: Bearer &lt;ADMIN_JWT&gt;\nAccept: application/json\n</code></pre> <p>Response:</p> <pre><code>[\n  {\n    \"Round_Centre_Code\": 12,\n    \"FSU_Serial_No\": 71558,\n    \"Round\": 68,\n    \"Sch_No\": 100\n  },\n  {\n    \"Round_Centre_Code\": 6,\n    \"FSU_Serial_No\": 71560,\n    \"Round\": 68,\n    \"Sch_No\": 101\n  }\n]\n</code></pre>"},{"location":"api/#example-2-csv-download","title":"Example 2: CSV Download","text":"<p>Request:</p> <pre><code>GET /datasets/block_5_2_usual_subsidiary_economic_activity_particulars_of_hou/query?limit=10&amp;columns=Round_Centre_Code,FSU_Serial_No,Round,Sch_No\n</code></pre> <p>Headers:</p> <pre><code>Authorization: Bearer &lt;JWT&gt;\nAccept: text/csv\n</code></pre> <p>Response (CSV):</p> <pre><code>Round_Centre_Code,FSU_Serial_No,Round,Sch_No\n12,71558,68,100\n6,71560,68,101\n</code></pre>"},{"location":"api/#example-3-non-admin-suppression-triggered","title":"Example 3: Non-Admin (Suppression Triggered)","text":"<p>Request:</p> <pre><code>GET /datasets/block_5_2_usual_subsidiary_economic_activity_particulars_of_hou/query?filters=FSU_Serial_No=71238;Round_Centre_Code=4&amp;limit=10\n</code></pre> <p>Headers:</p> <pre><code>Authorization: Bearer &lt;USER_JWT&gt;\nAccept: application/json\n</code></pre> <p>Response (403 Forbidden):</p> <pre><code>{\n  \"detail\": {\n    \"error\": \"Data Access Restricted\",\n    \"detail\": \"Data suppressed: Result contains 1 rows, which is below the minimum threshold of 5 rows required for privacy protection.\",\n    \"code\": \"CELL_SUPPRESSION_APPLIED\",\n    \"minimum_rows_required\": 5,\n    \"actual_rows\": 1\n  }\n}\n</code></pre>"},{"location":"api/#upload-dataset","title":"\ud83d\udcc4 Upload Dataset","text":"<p>POST <code>/upload/</code></p> <p>Upload a ZIP file containing <code>.csv</code>, <code>.txt</code>, and <code>.xml</code> (DDI) files.</p>"},{"location":"api/#form-data","title":"\ud83d\udd39 Form Data:","text":"Key Type Description <code>file</code> file ZIP file with dataset + DDI <code>schema</code> string Target schema (e.g., <code>public</code>, <code>plfs</code>)"},{"location":"api/#auth-required_1","title":"\ud83d\udd10 Auth Required:","text":"<ul> <li>Admin only</li> </ul> <p>Response:</p> <pre><code>&lt;h3&gt;\u2705 Upload successful!&lt;/h3&gt;\n</code></pre>"},{"location":"api/#view-current-user-debug","title":"\ud83d\udd0d View Current User (Debug)","text":"<p>GET <code>/debug/user-info</code></p> <p>Returns current user\u2019s email, role, and debug info.</p> <p>Response:</p> <pre><code>{\n  \"username\": \"statathon12@gmail.com\",\n  \"role\": 1,\n  \"is_admin\": true\n}\n</code></pre>"},{"location":"api/#test-suppression-logic-debug","title":"\ud83d\udd0e Test Suppression Logic (Debug)","text":"<p>GET <code>/debug/test-suppression</code></p> <p>Simulates a query returning &lt;5 rows and checks suppression logic.</p> <p>Response (for users):</p> <pre><code>{\n  \"message\": \"\u2705 Cell suppression is working correctly!\",\n  \"suppressed\": true,\n  \"user_role\": \"3\",\n  \"row_count\": 3\n}\n</code></pre> <p>Continue to Authentication \u2192</p>"},{"location":"auth/","title":"\ud83d\udd10 Authentication API","text":"<p>This document describes how to register, log in, and use authentication headers for Statathon API Gateway.</p>"},{"location":"auth/#register-a-new-user","title":"\ud83d\udd11 Register a New User","text":"<p>POST <code>/auth/register</code></p> <p>Create a new user account.</p>"},{"location":"auth/#body-json","title":"\ud83d\udce5 Body (JSON):","text":"<pre><code>{\n  \"username\": \"Sudheer\",\n  \"email\": \"statathon12@gmail.com\",\n  \"password\": \"mypassword\",\n  \"role_id\": 3\n}\n</code></pre>"},{"location":"auth/#roles","title":"\ud83c\udfad Roles:","text":"<ul> <li><code>1</code> \u2192 Admin</li> <li><code>3</code> \u2192 General User</li> </ul>"},{"location":"auth/#response","title":"Response:","text":"<pre><code>{\n  \"message\": \"User created successfully\"\n}\n</code></pre>"},{"location":"auth/#get-access-token","title":"\ud83d\udd10 Get Access Token","text":"<p>POST <code>/auth/token</code></p> <p>Use email + password to get JWT token.</p>"},{"location":"auth/#form-data","title":"\ud83d\udce5 Form Data:","text":"Key Type Example username string statathon12@gmail.com password string mypassword"},{"location":"auth/#response_1","title":"Response:","text":"<pre><code>{\n  \"access_token\": \"&lt;JWT_TOKEN&gt;\",\n  \"token_type\": \"bearer\"\n}\n</code></pre>"},{"location":"auth/#using-bearer-token","title":"\ud83d\udcce Using Bearer Token","text":"<p>After login, use the returned <code>access_token</code> in all protected routes.</p>"},{"location":"auth/#header-example","title":"\ud83d\udd10 Header Example:","text":"<pre><code>Authorization: Bearer &lt;JWT_TOKEN&gt;\n</code></pre>"},{"location":"auth/#token-lifetime","title":"\ud83d\udd01 Token Lifetime","text":"<ul> <li>JWT tokens are valid for 30 minutes by default.</li> <li>They are stateless and do not require server session storage.</li> </ul>"},{"location":"auth/#unauthorized-access","title":"\ud83d\udeab Unauthorized Access","text":"<p>If the token is invalid or expired:</p> <p>Response:</p> <pre><code>{\n  \"detail\": \"Could not validate credentials\"\n}\n</code></pre>"},{"location":"auth/#who-am-i-debug","title":"\ud83d\udd0d Who Am I? (Debug)","text":"<p>GET <code>/debug/user-info</code></p> <p>Check which user is currently authenticated.</p>"},{"location":"auth/#example","title":"Example:","text":"<pre><code>{\n  \"username\": \"statathon12@gmail.com\",\n  \"role\": 1,\n  \"is_admin\": true\n}\n</code></pre> <p>Return to API Reference \u2192</p>"},{"location":"usage/","title":"\ud83d\udcca Usage Metering","text":"<p>This section describes how the API Gateway tracks and limits usage for each user based on the number of rows accessed per day.</p>"},{"location":"usage/#row-based-usage-limit","title":"\u2705 Row-Based Usage Limit","text":"<p>Each user has a maximum number of rows they can access per day. This is tracked via a <code>usage_logs</code> table.</p>"},{"location":"usage/#default-limits","title":"\ud83d\udd39 Default Limits:","text":"Role Max Rows per Day Admin Unlimited User (role=3) 100,000 rows <p>Once the limit is exceeded, further requests are blocked for that day.</p>"},{"location":"usage/#usage-logging","title":"\ud83d\udce6 Usage Logging","text":"<p>Every data query (GET or POST) is logged with:</p> <ul> <li><code>user_email</code></li> <li><code>endpoint</code></li> <li><code>schema_name</code></li> <li><code>table_name</code></li> <li><code>rows_returned</code></li> <li><code>bytes_sent</code></li> <li><code>timestamp</code></li> </ul> <p>These logs are stored in the <code>usage_logs</code> table in PostgreSQL.</p>"},{"location":"usage/#example-user-limit-exceeded","title":"\ud83e\uddea Example: User Limit Exceeded","text":"<p>Request:</p> <pre><code>GET /datasets/table_name/query?limit=10000\n</code></pre> <p>Response (after hitting daily quota):</p> <pre><code>{\n  \"detail\": \"Daily usage limit exceeded\"\n}\n</code></pre>"},{"location":"usage/#suppressed-query-still-logged","title":"\ud83d\udee1\ufe0f Suppressed Query Still Logged","text":"<p>Even when a query is suppressed (for &lt;5 rows), a log entry is still made with:</p> <ul> <li><code>rows_returned = 0</code></li> <li><code>bytes_sent = 0</code></li> </ul>"},{"location":"usage/#admin-debug-tools","title":"\ud83d\udccc Admin Debug Tools","text":""},{"location":"usage/#endpoint-debuguser-info","title":"\ud83d\udd0e Endpoint: <code>/debug/user-info</code>","text":"<p>Returns your role and email for debugging.</p>"},{"location":"usage/#db-table-usage_logs","title":"\ud83d\udcca DB Table: <code>usage_logs</code>","text":"<p>You can query this table to generate usage analytics, billing, or throttling reports.</p> <p>Continue to Project Layout \u2192</p>"}]}